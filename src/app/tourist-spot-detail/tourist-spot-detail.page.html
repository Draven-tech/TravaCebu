<ion-header>
  <ion-toolbar color="warning">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/user-dashboard"></ion-back-button>
    </ion-buttons>
    <ion-title>Tourist Spot Details</ion-title>
    <ion-buttons slot="end">
      <ion-button 
        (click)="refreshImages()"
        [disabled]="isRefreshingImages"
        fill="clear"
        title="Refresh image from Google Places"
      >
        <ion-icon 
          [name]="isRefreshingImages ? 'refresh' : 'refresh-outline'"
          [class.spinning]="isRefreshingImages"
        ></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content *ngIf="spotData" class="spot-detail-content">
  <!-- Header Image -->
  <div class="spot-header-img">
    <img 
      [src]="spotData.img || 'assets/placeholder.jpg'" 
      [alt]="spotData.name" 
    />
    
    <!-- Image Help Overlay -->
    <div class="image-help-overlay">
      <ion-icon name="information-circle-outline" color="light"></ion-icon>
      <p>Tap refresh button in header to update image</p>
    </div>
  </div>

  <!-- Spot Info -->
  <ion-card class="spot-info-card">
    <ion-card-header>
      <ion-card-title>{{ spotData.name }}</ion-card-title>
      <ion-card-subtitle>{{ spotData.category }}</ion-card-subtitle>
    </ion-card-header>
    <ion-card-content>
      <p class="spot-description">{{ spotData.description }}</p>
      
    </ion-card-content>
  </ion-card>

  <!-- Add Review (Only for visited spots) -->
  <div *ngIf="hasVisited()" class="add-review-container">
    <div class="review-header">
      <h2>Add Your Review</h2>
      <ion-chip color="success" class="visited-indicator">
        <ion-icon name="checkmark-circle"></ion-icon>
        <ion-label>Visited</ion-label>
      </ion-chip>
    </div>

<ion-item lines="none" class="rating-slider" style="flex-direction: column; align-items: flex-start;">
  <ion-label position="stacked">Rating: {{ rating }}</ion-label>
  <ion-range
    min="1"
    max="5"
    step="1"
    snaps="true"
    pin="true"
    [(ngModel)]="rating"
    color="warning"
  >
    <ion-icon slot="start" name="sad-outline"></ion-icon>
    <ion-icon slot="end" name="happy-outline"></ion-icon>
  </ion-range>
</ion-item>
    <ion-item lines="none">
      <ion-label>Post as Anonymous</ion-label>
      <ion-toggle slot="end" [(ngModel)]="postAsAnonymous"></ion-toggle>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">Comment</ion-label>
      <ion-textarea [(ngModel)]="comment" placeholder="Share your experience..."></ion-textarea>
    </ion-item>

    <ion-item lines="none">
      <ion-label position="stacked">Upload Photo (optional)</ion-label>
      <input type="file" (change)="onFileSelected($event)" accept="image/*" />
    </ion-item>

    <ion-img *ngIf="selectedFilePreview" [src]="selectedFilePreview" class="preview-img"></ion-img>

    <ion-button expand="block" color="warning" (click)="addReview()" [disabled]="uploading">
      {{ uploading ? 'Uploading...' : 'Submit Review' }}
    </ion-button>
  </div>

  <!-- Review Restriction Message (For unvisited spots) -->
  <div *ngIf="!hasVisited()" class="review-restriction-container">
    <div class="restriction-card">
      <ion-icon name="lock-closed-outline" color="medium"></ion-icon>
      <h3>Reviews Locked</h3>
      <p>You need to visit this spot in person before you can post a review. This helps ensure authentic experiences!</p>
      
      <div class="suggestion-actions">
        <ion-button expand="block" fill="outline" color="primary" (click)="addToBucketList()">
          <ion-icon name="heart-outline"></ion-icon>
          Add to Bucket List
        </ion-button>
        <ion-button expand="block" color="success" (click)="markAsVisited()">
          <ion-icon name="checkmark-circle-outline"></ion-icon>
          Mark as Visited
        </ion-button>
        <p class="suggestion-text">Add this spot to your bucket list, then create an itinerary to visit it!</p>
      </div>
    </div>
  </div>

  <!-- Review List -->
  <div class="reviews-container">
    <h2>Reviews</h2>
    <div *ngIf="reviews.length > 0; else noReviewsTemplate">
      <ion-card *ngFor="let review of reviews" class="review-card">
        <ion-card-header>
          <ion-card-title>{{ review.username }}</ion-card-title>
          <ion-card-subtitle>‚≠ê {{ review.rating }}</ion-card-subtitle>
        </ion-card-header>
        <ion-card-content>
          <p class="review-comment">{{ review.comment }}</p>
          <ion-img *ngIf="review.photoUrl" [src]="review.photoUrl" class="review-img"></ion-img>
        </ion-card-content>
      </ion-card>
    </div>

    <ng-template #noReviewsTemplate>
      <ion-text color="medium">
        <p class="no-review-msg">No reviews yet. Be the first to leave one!</p>
      </ion-text>
    </ng-template>
  </div>
</ion-content>

<!-- Bottom Navigation -->
<app-bottom-nav></app-bottom-nav>