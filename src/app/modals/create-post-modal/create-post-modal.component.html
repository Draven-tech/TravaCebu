<ion-header>
  <ion-toolbar color="warning">
    <ion-buttons slot="start">
      <ion-button (click)="dismiss()">
        <ion-icon name="close"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>{{ isEditing ? 'Edit Post' : 'Create Post' }}</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="createPost()" [disabled]="uploading">
        <ion-icon name="checkmark"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="create-post-content">
  <div class="post-form">
    <!-- User Info Header -->
    <div class="user-info">
      <ion-avatar>
        <img [src]="userData?.photoURL || 'assets/img/default.png'" />
      </ion-avatar>
      <div class="user-details">
        <h4>{{ userData?.fullName || 'Anonymous' }}</h4>
        <p>Public Post</p>
      </div>
    </div>

    <!-- Post Type Selection -->
    <div class="post-type-section">
      <ion-segment [(ngModel)]="postType">
        <ion-segment-button value="regular">
          <ion-label>Regular Post</ion-label>
        </ion-segment-button>
        <ion-segment-button value="shared_itinerary">
          <ion-label>Share Itinerary</ion-label>
        </ion-segment-button>
      </ion-segment>
    </div>

    <!-- Post Content -->
    <div class="post-input-section">
      <ion-textarea
        [(ngModel)]="postContent"
        [placeholder]="postType === 'shared_itinerary' ? 'Share your travel experience...' : 'What\'s on your mind?'"
        rows="4"
        class="post-textarea"
        maxlength="1000"
        showCounter="true">
      </ion-textarea>
    </div>

    <!-- Regular Post Options -->
    <div *ngIf="postType === 'regular'" class="location-section">
      <ion-item lines="none">
        <ion-icon name="location-outline" slot="start" color="medium"></ion-icon>
        <ion-select
          [(ngModel)]="selectedSpotId"
          placeholder="Select a tourist spot (optional)"
          interface="popover">
          <ion-select-option value="">No location</ion-select-option>
          <ion-select-option 
            *ngFor="let spot of touristSpots" 
            [value]="spot.id">
            {{ spot.name }}
          </ion-select-option>
        </ion-select>
      </ion-item>
      
      <!-- Selected Spot Info -->
      <div *ngIf="selectedSpotId && getSelectedSpot()" class="selected-spot-info">
        <ion-item lines="none">
          <ion-icon name="location" slot="start" color="warning"></ion-icon>
          <ion-label>
            <h3>{{ getSelectedSpot()?.name }}</h3>
            <p>{{ getSelectedSpot()?.description }}</p>
          </ion-label>
        </ion-item>
      </div>
    </div>

    <!-- Itinerary Sharing Options -->
    <div *ngIf="postType === 'shared_itinerary'" class="itinerary-section">
      <ion-item lines="none">
        <ion-icon name="calendar-outline" slot="start" color="primary"></ion-icon>
        <ion-select
          [(ngModel)]="selectedItineraryId"
          placeholder="Select completed itinerary to share"
          interface="popover"
          [disabled]="loadingItineraries">
          <ion-select-option value="">Choose itinerary...</ion-select-option>
          <ion-select-option 
            *ngFor="let itinerary of completedItineraries" 
            [value]="itinerary.id">
            {{ itinerary.name }}
          </ion-select-option>
        </ion-select>
      </ion-item>
      
      <!-- Selected Itinerary Preview -->
      <div *ngIf="selectedItineraryId && getSelectedItinerary()" class="selected-itinerary-info">
        <ion-card>
          <ion-card-header>
            <ion-card-title>{{ getSelectedItinerary()?.name }}</ion-card-title>
            <ion-card-subtitle>{{ getSelectedItinerary()?.date }}</ion-card-subtitle>
          </ion-card-header>
          <ion-card-content>
            <h4>Places visited:</h4>
            <ion-list>
              <ion-item *ngFor="let spot of getSelectedItinerary()?.spots" lines="none">
                <ion-icon name="location" slot="start" color="warning"></ion-icon>
                <ion-label>
                  <h3>{{ spot.name }}</h3>
                  <p *ngIf="spot.timeSlot">{{ spot.timeSlot }} - {{ spot.duration }}</p>
                </ion-label>
              </ion-item>
            </ion-list>
          </ion-card-content>
        </ion-card>
      </div>

      <!-- No Itineraries Message -->
      <div *ngIf="!loadingItineraries && completedItineraries.length === 0" class="no-itineraries">
        <ion-item lines="none">
          <ion-icon name="information-circle-outline" slot="start" color="medium"></ion-icon>
          <ion-label>
            <h3>No completed itineraries</h3>
            <p>Complete some trips first to share your itineraries!</p>
          </ion-label>
        </ion-item>
      </div>
    </div>

    <!-- Image Preview -->
    <div *ngIf="imagePreview" class="image-preview-section">
      <div class="image-preview-container">
        <img [src]="imagePreview" class="preview-image" />
        <ion-button
          fill="clear"
          class="remove-image-btn"
          (click)="removeImage()">
          <ion-icon name="close-circle" color="danger"></ion-icon>
        </ion-button>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="post-actions">
      <ion-button
        fill="clear"
        class="action-btn"
        (click)="selectImage()">
        <ion-icon name="image-outline" slot="start"></ion-icon>
        Photo
      </ion-button>
    </div>

    <!-- Hidden file input -->
    <input
      type="file"
      accept="image/*"
      (change)="onImageSelected($event)"
      hidden
      #imageInput
    />
  </div>
</ion-content> 